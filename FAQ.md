# ❓ Часто задаваемые вопросы (FAQ)

## Установка и настройка

### Q: Какая версия Python требуется?
**A:** Python 3.10 или выше. Проверьте версию командой:
```bash
python3 --version
```

### Q: Нужно ли устанавливать wkhtmltopdf?
**A:** Нет! Мы используем WeasyPrint, которая не требует внешних исполняемых файлов. Это одно из ключевых преимуществ нашего решения.

### Q: Почему WeasyPrint, а не pdfkit?
**A:** WeasyPrint:
- ✅ Не требует wkhtmltopdf
- ✅ Лучшая поддержка Unicode (кириллица)
- ✅ Активно поддерживается
- ✅ Более стабильная работа с изображениями
- ✅ Лучшая CSS3 поддержка

pdfkit устарел и требует wkhtmltopdf (который больше не развивается).

### Q: Как получить токен Telegram бота?
**A:**
1. Откройте [@BotFather](https://t.me/botfather) в Telegram
2. Отправьте `/newbot`
3. Следуйте инструкциям
4. Скопируйте полученный токен
5. Сохраните в переменную окружения или .env файл

### Q: Где хранить токен бота безопасно?
**A:** 
**Лучший способ:** Переменная окружения
```bash
export TELEGRAM_BOT_TOKEN="ваш_токен"
```

**Альтернатива:** Файл .env (не коммитьте в Git!)
```
TELEGRAM_BOT_TOKEN=ваш_токен
```

**Не рекомендуется:** Прямо в коде (только для тестирования)

## Ошибки установки

### Q: Ошибка "No module named 'telegram'"
**A:** Активируйте виртуальное окружение и переустановите зависимости:
```bash
source venv/bin/activate  # Linux/macOS
pip install -r requirements.txt
```

### Q: Ошибка "OSError: cannot load library 'gobject-2.0-0'" (Linux)
**A:** Установите системные библиотеки:
```bash
sudo apt-get install libgobject-2.0-0 libpango-1.0-0 libgdk-pixbuf2.0-0
```

### Q: Ошибка при установке WeasyPrint на Windows
**A:** 
1. Скачайте GTK3 Runtime: https://github.com/tschoonj/GTK-for-Windows-Runtime-Environment-Installer/releases
2. Установите с опцией "Add to PATH"
3. Перезагрузите командную строку
4. Переустановите пакеты: `pip install -r requirements.txt`

**Альтернатива:** Используйте WSL2 (Windows Subsystem for Linux)

### Q: pip install завершается с ошибкой компиляции
**A:** Убедитесь, что установлены build-tools:

**Linux:**
```bash
sudo apt-get install python3-dev build-essential
```

**macOS:**
```bash
xcode-select --install
```

## Работа бота

### Q: Бот не отвечает на сообщения
**A:** Проверьте:
1. Бот запущен? (`python main.py` должен выдавать логи)
2. Токен правильный?
3. Интернет соединение работает?
4. Проверьте логи на ошибки

### Q: Бот выдает "Token not set"
**A:** Установите токен:
```bash
export TELEGRAM_BOT_TOKEN="ваш_токен"
```
Или отредактируйте main.py, заменив `YOUR_BOT_TOKEN_HERE`.

### Q: Бот обрабатывает запросы очень долго
**A:** Возможные причины:
- Медленное интернет соединение
- Статья содержит много больших изображений
- Сервер перегружен

Типичное время обработки:
- Короткая статья: 2-5 секунд
- Средняя статья: 5-10 секунд
- Длинная с изображениями: 10-20 секунд

### Q: Как ограничить скорость обработки запросов?
**A:** Включите rate limiting в config_example.py:
```python
RATE_LIMIT_ENABLED = True
RATE_LIMIT_REQUESTS = 10  # 10 запросов
RATE_LIMIT_PERIOD = 3600  # за 1 час
```

## PDF Generation

### Q: PDF создается без изображений
**A:** Проверьте:
1. Интернет соединение (WeasyPrint загружает изображения онлайн)
2. Изображения в статье не удалены автором
3. URL изображений корректны (проверьте в логах)

Для отладки включите DEBUG логирование в main.py.

### Q: Как изменить стиль PDF?
**A:** Отредактируйте константу `PDF_STYLES` в main.py. Например:

**Изменить шрифт:**
```python
body {
    font-family: 'Arial', sans-serif;  # Было: Georgia
}
```

**Изменить размер шрифта:**
```python
body {
    font-size: 14pt;  # Было: 12pt
}
```

**Изменить отступы:**
```python
@page {
    margin: 3cm;  # Было: 2cm
}
```

### Q: Можно ли добавить watermark (водяной знак)?
**A:** Да! Добавьте в CSS:
```python
@page {
    @bottom-center {
        content: "Сгенерировано ботом";
        font-size: 8pt;
        color: #ccc;
    }
}
```

### Q: PDF слишком большой (>50MB)
**A:** Telegram ограничивает размер файлов до 50MB. Решения:
1. Уменьшите качество изображений в CSS
2. Разделите статью на части
3. Используйте внешнее хранилище (Google Drive, Dropbox)

### Q: Как добавить нумерацию страниц?
**A:** Добавьте в PDF_STYLES:
```python
@page {
    @bottom-right {
        content: "Страница " counter(page) " из " counter(pages);
    }
}
```

### Q: Кириллица отображается некорректно
**A:** WeasyPrint отлично поддерживает Unicode. Убедитесь, что:
1. HTML в кодировке UTF-8
2. Используются шрифты с поддержкой кириллицы (Georgia, Arial)

Если проблема сохраняется, попробуйте другой шрифт в PDF_STYLES.

## Парсинг статей

### Q: Какие домены поддерживаются?
**A:** 
- telegra.ph
- teletype.in
- graph.org

Можно добавить другие в константе `VALID_DOMAINS` в main.py.

### Q: Поддерживается ли Medium, VC.ru, Habr?
**A:** Нет, только Telegraph/Teletype. Для других сайтов нужно писать отдельные парсеры.

### Q: Бот не может спарсить конкретную статью
**A:** Возможные причины:
1. Статья удалена автором
2. Изменилась структура HTML Telegraph
3. Статья защищена паролем

Проверьте логи бота и попробуйте открыть статью в браузере.

### Q: Как добавить поддержку нового домена?
**A:** 
1. Добавьте домен в `VALID_DOMAINS`
2. Проверьте структуру HTML страницы
3. При необходимости измените парсер в функции `fetch_article()`

## Развертывание

### Q: Как запустить бота в фоновом режиме?
**A:** 

**Простой способ (screen/tmux):**
```bash
screen -S telegraph-bot
python main.py
# Нажмите Ctrl+A, затем D для отсоединения
```

**Профессиональный способ (systemd):**
```bash
sudo cp telegraph-bot.service /etc/systemd/system/
sudo systemctl enable telegraph-bot
sudo systemctl start telegraph-bot
```

### Q: Как просмотреть логи бота?
**A:**

**Если запущен через systemd:**
```bash
sudo journalctl -u telegraph-bot -f
```

**Если запущен в screen:**
```bash
screen -r telegraph-bot
```

### Q: Как обновить бота?
**A:**
```bash
# Остановите бота
sudo systemctl stop telegraph-bot  # или Ctrl+C

# Получите новую версию (git pull или скачайте файлы)
git pull

# Обновите зависимости
source venv/bin/activate
pip install -r requirements.txt --upgrade

# Запустите снова
sudo systemctl start telegraph-bot
```

### Q: Как запустить несколько экземпляров бота?
**A:** Каждый экземпляр должен иметь:
- Уникальный токен бота
- Уникальную директорию temp_pdfs
- Уникальный порт (если используете webhooks)

### Q: Можно ли использовать на бесплатном хостинге?
**A:** Да, но с ограничениями:

**Heroku:** ✅ Работает, но нужен buildpack для системных библиотек
**PythonAnywhere:** ❌ Ограничения на внешние соединения
**Replit:** ✅ Работает
**Railway:** ✅ Работает
**Render:** ✅ Работает

## Docker

### Q: Как запустить в Docker?
**A:**
```bash
# Сборка образа
docker build -t telegraph-bot .

# Запуск
docker run -d --name telegraph-bot \
    -e TELEGRAM_BOT_TOKEN=your_token \
    --restart unless-stopped \
    telegraph-bot
```

Или используйте docker-compose:
```bash
docker-compose up -d
```

### Q: Как просмотреть логи Docker контейнера?
**A:**
```bash
docker logs -f telegraph-bot
```

### Q: Как остановить/удалить контейнер?
**A:**
```bash
docker stop telegraph-bot
docker rm telegraph-bot
```

## Безопасность

### Q: Безопасно ли хранить токен в коде?
**A:** ❌ Нет! Никогда не храните токены в коде, особенно если код в публичном репозитории.

Используйте:
- Переменные окружения
- .env файл (добавьте в .gitignore)
- Секреты CI/CD

### Q: Может ли бот прочитать мои личные сообщения?
**A:** Нет, бот видит только сообщения, отправленные напрямую ему.

### Q: Куда сохраняются PDF файлы?
**A:** Временно в директорию `temp_pdfs/`, затем автоматически удаляются после отправки пользователю.

### Q: Логируются ли запросы пользователей?
**A:** Логируется только ID пользователя и результат обработки. Содержимое статей не сохраняется.

## Производительность

### Q: Сколько памяти требуется боту?
**A:** 
- Минимум: ~128 MB
- Рекомендуется: 256-512 MB
- С большой нагрузкой: 1 GB

### Q: Сколько запросов может обработать?
**A:** При асинхронной работе:
- 1-10 пользователей: без проблем
- 10-100 пользователей: возможны задержки
- 100+ пользователей: нужна оптимизация или несколько инстансов

### Q: Как ускорить генерацию PDF?
**A:**
1. Уменьшите качество изображений
2. Используйте кеширование для часто запрашиваемых статей
3. Запустите несколько экземпляров бота
4. Используйте более мощный сервер

## Отладка

### Q: Как включить подробное логирование?
**A:** В main.py измените:
```python
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.DEBUG  # Было: INFO
)
```

### Q: Как протестировать парсинг без Telegram?
**A:** Используйте функцию напрямую:
```python
from main import fetch_article

article = fetch_article('https://telegra.ph/Test-01-01')
print(article)
```

### Q: Как протестировать генерацию PDF локально?
**A:** Добавьте в main.py:
```python
if __name__ == '__main__':
    test_data = {
        'title': 'Test',
        'author': 'Bot',
        'content': '<p>Test content</p>'
    }
    generate_pdf(test_data, Path('./test.pdf'))
```

## Расширение функционала

### Q: Как добавить поддержку других форматов (EPUB, MOBI)?
**A:** Используйте библиотеку `ebooklib` для EPUB:
```bash
pip install ebooklib
```

### Q: Можно ли добавить перевод текста?
**A:** Да, интегрируйте Google Translate API или DeepL.

### Q: Как добавить поддержку голосовых сообщений?
**A:** Используйте библиотеку `pyttsx3` или Google Text-to-Speech API.

### Q: Можно ли сохранять статистику?
**A:** Да, добавьте SQLite базу данных или используйте Redis для кеширования.

## Дополнительная помощь

### Q: Где получить помощь?
**A:**
1. Проверьте README.md
2. Посмотрите EXAMPLES.md
3. Изучите логи бота
4. Создайте Issue на GitHub
5. Задайте вопрос в Telegram группе поддержки

### Q: Как сообщить об ошибке?
**A:** Создайте Issue с:
- Описанием проблемы
- Шагами для воспроизведения
- Логами ошибок
- Версией Python и ОС

### Q: Могу ли я использовать бота коммерчески?
**A:** Да, проект под лицензией MIT. Можете использовать в коммерческих целях.

---

**Не нашли ответ? Создайте Issue или обратитесь к разработчику!**
